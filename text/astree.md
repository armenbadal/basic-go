# Վերլուծության ծառ

_Աբստրակտ քերականական ծառը_ (այսուհետ՝ _քերականական ծառ_ կամ պարզապես _ծառ_) այն օբյեկտն է, որը կառուցվում է ծրագրի շարահյուսական վերլուծության արդյունքում որպես ծրագրի ժամանակավոր, միջանկյալ ներկայացում։ Ինտերպրետատորի իրականացման դեպքում այս ծառն օգտագործվում է _հաշվարկման_ համար, իսկ
կոմպիլյատորի իրականացման դեպքում այս ծառից գեներացվում է կոնկրետ պլատֆորմի նպատակային կոդ։

Քերականական ծառը ճիշտ կառուցելու համար լեզվի քերականության յուրաքանչյուր ինքնուրույն տարրի համար պետք է սահմանել համապատասխան ստրուկտուրա (տիպ)։ Այսպես, ծառում _ծրագիրը_ պետք է ունենա ի՛ր հանգույցը, _ենթածրագիրն_՝ իր, _հրամաններն_ ու _արտահայտություններն_՝ իրենցը, և այլն։ Այդ հանգույցների տեսքը դուրս է բերվում անմիջապես քերականական հավասարումից։ 

Լեզվի քերականությունը սահմանելիս ծրագրի համար գրեցի հետևյալ հավասարումը․

```
Program = { Subroutine }.
```

Ըստ այսմ կարող եմ `Program` ստրուկտուրան սահմանել որպես ենթածրագրերի ցուցակ։ Իսկ, որ ավելի հարմար է, ենթածրագրերի անունը օբյեկտին համապատասխանեցնող արտապատկերում․

```Go
type Program struct {
	Subroutines map[string]*Subroutine // ենթածրագրեր
}
```

Ենթածրագիրը ներկայացնող հանգույցի ստրուկտուրան, թերևս, սպասվածից էլ պարզ է. այն պարունակում է  անունը, պարամետրերի ցուցակը և մարմնի ենթածառը։

```Go
type Subroutine struct {
	Name       string    // անուն
	Parameters []string  // պարամետրեր
	Body       Statement // մարմին
}
```

`Statement`֊ը Բալի հրամանների ինտերֆեյսն է և սահմանված է հետևյալ կերպ․

```Go
type Statement any
```

Այնուհետև առանձին-առանձին սահմանված են Բալ լեզվի ութ հրամանները ներկայացնող հանգույցները։ Զանգվածների սահմանման `DIM` հրամանի համար սահմանված հանգույցի տիպը պարունակում է զանգվածի անունն ու տարրերի քանակը։

```Go
type Dim struct {
	Name string     // անունը
	Size Expression // չափը
}
```

Վերագրման `LET` հրամանի `Place` դաշտով որոշվում է այն տեղը, որին պիտի վերագրել `Value` դաշտից հաշվարկած արժեքը։

```Go
type Let struct {
	Place Expression  // վերագրման տեղը
	Value Expression  // վերագրվող արժեքը
}
```

Ներմուծման հրամանի հանգույցի տիպում միայն այն տեղի հղումն է, որտեղ պետք է պահել ներմուծված արժեքը։

```Go
type Input struct {
	Place Expression  // արժեքը պահելու տեղը
}
```

Արտածման հրամանի հանգույցում էլ արտածվող արժեքը ներկայացնող արտահայտության ենթածառն է։

```Go
type Print struct {
	Value Expression  // արտածվելիք արժեք
}
```

Պայմանի կամ ճյուղավորման հրամանը ներկայացնող հանգույցի տիպն ունի երեք դաշտ՝ պայմանի, դրական ու բացասական ընտրությունների ենթածառերի համար։

```Go
type If struct {
	Condition   Expression  // պայման
	Decision    Statement   // դրական ընտրություն
	Alternative Statement   // բացասական ընտրություն
}
```

Նախապայմանով ցիկլի նկարագրման `While` տիպը հղումներ է պարունակում ցիկլի կատարման պայմանի ու մարմնի ենթածառերին։

```Go
type While struct {
	Condition Expression  // կատարման պայման
	Body      Statement   // մարմին
}
```

Իսկ պարամետրով ցիկլը ներկայացնող հանգույցի `For` տիպը

```Go
type For struct {
	Parameter Expression  // հաշվիչը
	Begin     Expression  // հաշվիչի սկզբնական արժեք
	End       Expression  // հաշվիչի վերջնական արժեք
	Step      Expression  // հաշվիչի քայլը
	Body      Statement   // մարմինը
}
```

Ենթածրագրի կանչի `CALL` հրամանի համար օգտագործում եմ ենթածրագիր-ֆունկցիայի կիրառման հանգույցի `Apply` տիպը։

```Go
type Call = Apply
```

Եվ վերջապես, հրամանների հաջորդականության հանգույցի տիպը, որը պարզապես պարունակում է հրամանների ենթածառերի ցուցակը։

```Go
type Sequence struct {
	Items []Statement // հրամաններ
}
```




Ամենապարզ հանգույցները նախատեսված են բուլյան արժեքների, թվերի, տեքստերի լիտերալների և փոփոխականների ներկայացման համար։ Այս տիպի հանգույցները վերլուծության ծառում հանդիպում են միայն որպես _տերևներ_։

```Go
// Boolean Բուլյան լիտերալ
type Boolean struct {
	Value bool // տրամաբանական հաստատուն
}

// Number Թվային լիտերալ
type Number struct {
	Value float64 // թվային հաստատուն
}

// Text Տեքստային լիտերալ
type Text struct {
	Value string // տեքստային հաստատուն
}

// Variable Փոփոխական
type Variable struct {
	Name string // փոփոխականի անունը
}
```

Զանգվածի լիտերալի ներկայացման համար `Array` հանգույցն է, որի `Elements` դաշտը `Node`-երի ցուցակ է.

```Go
type Array struct {
	Elements []Expression  // զանգվածի տարրերը
}
```

Լեզվում ներդրված գործողությունները երկու տեսակի են՝ միտեղանի (ունար, unary) և երկտեղանի (բինար, binary)։ Դրանց համար սահմանված են համապատասխանաբար `Unary` և `Binary` հանգույցները.

```Go
type Unary struct {
	Operation string  // գործողությունը
	Right     Expression    // արգումենտը
}

// Binary Բինար գործողություն
type Binary struct {
	Operation   string // գործողությունը
	Left Expression
	Right Expression   // ձախ ու աջ արգումենտները
}

```

Արտահայտություններում ֆունկցիա-ենթածրագրերի կիրառությունը ներկայացնելու համար սահմանված է `Apply` հանգույցը, որի `Callee` դաշտը կիրառվելի ենթածրագրի անունն է, իսկ `Arguments` զանգվածը՝ կիրառման արգումենտների ցուցակը։ 

```Go
// Apply Ֆունկցիայի կիրառում
type Apply struct {
	Callee    string  // ենթածրագրի անուն
	Arguments []Expression  // արգումենտների ցուցակ
}
```

